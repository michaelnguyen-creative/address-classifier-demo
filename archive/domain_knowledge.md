# Vietnamese Address System - Domain Knowledge Guide

## 1. Vietnamese Administrative Hierarchy

### 1.1 Three-Level Administrative Structure

Vietnam follows a strict **3-level administrative hierarchy**:

```
Country (Quốc gia)
└── Province/Municipality (Tỉnh/Thành phố Trung ương) - 63 units
    └── District/County (Huyện/Quận/Thị xã/Thành phố thuộc tỉnh) - ~700 units  
        └── Ward/Commune (Xã/Phường/Thị trấn) - ~11,000 units
```

### 1.2 Administrative Unit Types & Characteristics

#### **Level 1: Province/Municipality (Tỉnh/Thành phố)**
- **Total**: 63 units nationwide
- **Types**:
  - **Tỉnh** (Province) - 58 units: Rural/mixed areas
  - **Thành phố Trung ương** (Central Municipality) - 5 units: Major cities

| Type | Count | Examples | Characteristics |
|------|-------|----------|----------------|
| Tỉnh | 58 | Nghệ An, Long An, Bình Định | General provinces |
| TP Trung ương | 5 | Hà Nội, TP.HCM, Đà Nẵng, Hải Phòng, Cần Thơ | Special municipalities |

#### **Level 2: District (Quận/Huyện/Thị xã/TP thuộc tỉnh)**
- **Total**: ~700 units nationwide
- **Types**:

| Type | Vietnamese | Usage Context | Abbreviation | Characteristics |
|------|-----------|---------------|--------------|-----------------|
| Quận | Quận | Urban districts in major cities | Q. | Dense urban areas |
| Huyện | Huyện | Rural/suburban districts | H. | Rural/mixed areas |
| Thị xã | Thị xã | Towns | TX. | Medium-sized towns |
| Thành phố thuộc tỉnh | Thành phố | Provincial cities | TP. | Cities within provinces |

#### **Level 3: Ward/Commune (Phường/Xã/Thị trấn)**
- **Total**: ~11,000 units nationwide
- **Types**:

| Type | Vietnamese | Usage Context | Abbreviation | Characteristics |
|------|-----------|---------------|--------------|-----------------|
| Phường | Phường | Urban wards | P. | Urban neighborhoods |
| Xã | Xã | Rural communes | X. | Rural villages |
| Thị trấn | Thị trấn | Towns | TT. | Small towns |

## 2. Address Format Conventions

### 2.1 Standard Official Format

**Hierarchical Order**: Ward → District → Province (Specific → General)

```
[Administrative Type] [Name], [Administrative Type] [Name], [Administrative Type] [Name]
```

**Examples**:
```
Xã Thịnh Sơn, Huyện Đô Lương, Tỉnh Nghệ An
Phường 1, Quận 1, Thành phố Hồ Chí Minh  
Thị trấn Cần Thạnh, Huyện Cần Giờ, Thành phố Hồ Chí Minh
```

### 2.2 Common Abbreviation Patterns

#### **Full vs Abbreviated Forms**
| Full Form | Abbreviated | Ultra-Short | Notes |
|-----------|-------------|-------------|-------|
| Tỉnh Nghệ An | T. Nghệ An | Nghệ An | Province often omitted |
| Huyện Đô Lương | H. Đô Lương | Đô Lương | Very common abbreviation |
| Xã Thịnh Sơn | X. Thịnh Sơn | Thịnh Sơn | Least commonly abbreviated |
| Quận 1 | Q. 1 | Q1 | Numbers often merged |
| Phường 15 | P. 15 | P15 | Numbers often merged |

#### **Punctuation Variations**
```
Standard:    "Xã Thịnh Sơn, Huyện Đô Lương, Tỉnh Nghệ An"
No commas:   "Xã Thịnh Sơn Huyện Đô Lương Tỉnh Nghệ An"
Mixed punct: "Xã Thịnh Sơn H. Đô Lương - T. Nghệ An"
Dash style:  "Xã Thịnh Sơn - Huyện Đô Lương - Tỉnh Nghệ An"
```

### 2.3 ID Document Address Formats

**Vietnamese ID Cards** typically use **abbreviated format** due to space constraints:

```
Common ID Format: "X. [Ward] H. [District] T. [Province]"
Example: "X. Thịnh Sơn H. Đô Lương T. Nghệ An"
```

**Variations on ID Documents**:
```
"Xã Thịnh Sơn H. Đô Lương T. Nghệ An"     # Mixed abbreviation
"X Thuận Thành H. Cần Giuộc T. Long An"   # Missing periods  
"TT. Cần Thạnh, H. Cần Giờ, TP.HCM"       # Complex hierarchy
```

## 3. Geographic and Linguistic Patterns

### 3.1 Naming Convention Patterns

#### **Common Ward/Commune Name Patterns**
| Pattern Type | Examples | Frequency | Notes |
|-------------|----------|-----------|-------|
| **Directional** | Đông, Tây, Nam, Bắc | Very High | Often combined: "Thịnh Đông" |
| **Numbers** | 1, 2, 3...15 | High | Urban areas: "Phường 1, Phường 2" |
| **Prosperity** | Thịnh, Thành, Phước, An | High | "Thịnh Sơn", "Thành Công" |
| **Natural** | Sơn (mountain), Hà (river) | Medium | "Thịnh Sơn", "Hà Nội" |
| **Historical** | Historic names, heroes | Medium | Context-dependent |

#### **Common District Name Patterns**
| Pattern Type | Examples | Notes |
|-------------|----------|-------|
| **Numbered** | Quận 1, 2, 3...12 | Major cities (HCMC, Hanoi) |
| **Geographic** | Đông Hà, Tây Ninh | Directional/location based |
| **Historical** | Ba Đình, Hoàn Kiếm | Historical significance |
| **Compound** | Hồng Bàng, Lê Chân | Two-word combinations |

#### **Province Name Characteristics**
- **Directional compounds**: "Bắc Giang" (North River), "Nam Định" (South Settlement)  
- **Geographic features**: "Cao Bằng" (High Plateau), "Hà Giang" (River Boundary)
- **Historical names**: "Nghệ An" (Peaceful Arts), "Thừa Thiên Huế" (Imperial legacy)

### 3.2 Regional Variations

#### **Northern Vietnam (Miền Bắc)**
- More formal administrative language
- Traditional Vietnamese naming
- Examples: "Hà Nội", "Hải Phòng", "Quảng Ninh"

#### **Central Vietnam (Miền Trung)**  
- Mixed traditional/modern naming
- Historical imperial influence
- Examples: "Huế", "Đà Nẵng", "Quảng Nam"

#### **Southern Vietnam (Miền Nam)**
- More practical/modern naming
- French colonial influence traces
- Examples: "TP.HCM", "Cần Thơ", "An Giang"

## 4. OCR Error Patterns & Challenges

### 4.1 Common OCR Misreadings

#### **Diacritic Errors** (Most Common)
| Correct | OCR Misread | Type | Frequency |
|---------|-------------|------|-----------|
| ã | a, â, ă | Tilde removal | Very High |
| ô | o, ơ | Circumflex removal | Very High |  
| ư | u, ứ | Horn removal | High |
| ệ | e, ê | Complex diacritic | High |
| ậ | a, ă, â | Complex diacritic | High |

**Impact Examples**:
```
Correct:    "Xã Thịnh Sơn"  
OCR reads:  "Xa Thinh Son", "Xã Thịnh Son", "Xa Thịnh Son"
```

#### **Character Confusion**
| Correct | Confused With | Context |
|---------|---------------|---------|
| H | K, N | "H. Đô Lương" → "K. Đô Lương" |
| T | I, L | "T. Nghệ An" → "I. Nghệ An" |
| G | C, Q | "Long An" → "Lonc An" |
| n | m, r | "Thịnh" → "Thịmh", "Thịrh" |

#### **Spacing Errors**
```
Correct:     "Đô Lương"
OCR errors:  "ĐôLương", "Đô Lường", "Đô  Lương" (double space)
```

### 4.2 Systematic OCR Degradation Patterns

#### **Print Quality Issues**
- **Faded text**: Missing characters, partial characters
- **Smudged text**: Character bleeding, unclear boundaries  
- **Worn documents**: Creases affecting specific regions

#### **Font/Style Issues**  
- **Handwritten portions**: Names filled in by hand
- **Mixed fonts**: Official stamp vs printed text
- **Size variations**: Small text misread more frequently

### 4.3 Real-World OCR Examples from Vietnamese IDs

```json
{
  "ground_truth": "Xã Thịnh Sơn, Huyện Đô Lương, Tỉnh Nghệ An",
  "ocr_variants": [
    "Xa Thinh Son H. Do Luong T. Nghe An",           // Diacritics lost
    "Xã Thịnh Son H. Đô Lương T. Nghệ An",          // Partial diacritics  
    "X Thịnh Sơn H. Đô Lương T. Nghệ An",           // Missing punctuation
    "Xã ThinlnSon H. Đô Lương T. Nghệ An",          // Character confusion
    "Xã Thịnh Sơn K. Đô Lương T. Nghệ An",          // H→K confusion
    "Xã Thịnh Sơn H.Đô Lương T.Nghệ An",            // Missing spaces
    "Xã  Thịnh  Sơn  H.  Đô  Lương  T.  Nghệ  An"  // Extra spaces
  ]
}
```

## 5. Business Rules & Validation Logic

### 5.1 Geographic Consistency Rules

#### **Hierarchical Constraints** (Critical for Validation)
- **Rule**: Each ward/commune belongs to exactly ONE district
- **Rule**: Each district belongs to exactly ONE province
- **Rule**: Invalid combinations should be rejected

**Examples**:
```python
# VALID: Geographic consistency maintained
{
  "province": "Nghệ An", 
  "district": "Đô Lương",     # Đô Lương IS in Nghệ An
  "ward": "Thịnh Sơn"        # Thịnh Sơn IS in Đô Lương
}

# INVALID: Geographic inconsistency  
{
  "province": "Long An",
  "district": "Đô Lương",     # ERROR: Đô Lương is NOT in Long An
  "ward": "Thịnh Sơn"        # ERROR: Even if ward name exists elsewhere
}
```

#### **Administrative Type Consistency**
- **Urban districts (Quận)** only contain **urban wards (Phường)**
- **Rural districts (Huyện)** can contain **communes (Xã)** or **towns (Thị trấn)**
- **Mixed cases exist** but follow patterns

### 5.2 Name Disambiguation Rules

#### **Common Name Conflicts**
Many ward/district names are **duplicated across Vietnam**:

```python
# Example: "Phường 1" exists in multiple cities
duplicate_names = {
  "Phường 1": [
    {"province": "TP.HCM", "district": "Quận 1"},
    {"province": "TP.HCM", "district": "Quận 3"}, 
    {"province": "Hà Nội", "district": "Ba Đình"},
    # ... dozens more
  ]
}
```

**Disambiguation Strategy**:
1. **Use district context** to resolve ward ambiguity
2. **Use province context** to resolve district ambiguity  
3. **Prioritize complete hierarchies** over partial matches

### 5.3 Confidence Scoring Business Rules

#### **Confidence Factors** (for algorithm design)

| Factor | Weight | Reasoning |
|--------|--------|-----------|
| **Complete hierarchy match** | 40% | Full geographic consistency |
| **Exact string match** | 30% | No OCR errors detected |
| **Administrative type consistency** | 15% | Proper hierarchy types |
| **Common name patterns** | 10% | Follows expected patterns |
| **String similarity** | 5% | Fuzzy match quality |

#### **Business Priority Rules**
1. **Perfect matches** always preferred over partial
2. **Geographic consistency** overrides string similarity
3. **Common names** (Phường 1) require district context
4. **Rare names** can be matched with higher tolerance

## 6. Data Quality & Completeness

### 6.1 Reference Data Characteristics

#### **Province Level (63 units)**
- **Completeness**: 100% - fully enumerated
- **Stability**: High - rarely changes
- **Ambiguity**: Very low - unique names

#### **District Level (~700 units)**  
- **Completeness**: ~98% - mostly complete
- **Stability**: Medium - occasional reorganization
- **Ambiguity**: Low - some duplicates across provinces

#### **Ward/Commune Level (~11,000 units)**
- **Completeness**: ~95% - some rural areas incomplete
- **Stability**: Low - frequent reorganization
- **Ambiguity**: High - many duplicate names

### 6.2 Data Update Frequency

| Administrative Level | Update Frequency | Impact on Classifier |
|---------------------|------------------|---------------------|
| **Province** | ~5 years | Very low - stable reference |
| **District** | ~2 years | Low - occasional updates needed |
| **Ward/Commune** | ~6 months | Medium - regular updates needed |

### 6.3 Missing Data Patterns

#### **Common Gaps**
- **Remote rural communes**: May not be in reference lists
- **New developments**: Recently created administrative units
- **Reorganized areas**: Name changes not yet updated

#### **Mitigation Strategies**
- Use **partial matching** when complete hierarchy unavailable
- Implement **fuzzy matching** for potential name changes
- **Log unknown combinations** for manual review

## 7. Cultural & Linguistic Context

### 7.1 Vietnamese Language Characteristics

#### **Diacritic System**
Vietnamese uses **6 tones** marked with diacritics:
- **Flat (ngang)**: a
- **Sharp (sắc)**: á  
- **Heavy (nặng)**: ạ
- **Curve (huyền)**: à
- **Tilde (ngã)**: ã
- **Hook (hỏi)**: ả

**OCR Impact**: Tone marks frequently lost/corrupted, changing meaning

#### **Compound Words**
Vietnamese administrative names often use **compound structures**:
- **Descriptive compounds**: "Thịnh Sơn" (Prosperous Mountain)
- **Directional compounds**: "Đông Hà" (East River)  
- **Historical compounds**: "Hồng Bàng" (Red Table - historical reference)

### 7.2 Regional Language Variations

#### **Dialectal Differences** (Minor impact on addresses)
- **Northern**: More formal, traditional terms
- **Central**: Historical imperial terminology  
- **Southern**: Simplified, practical naming

#### **Historical Name Evolution**
- **Pre-1975**: Different naming conventions North/South
- **Post-1975**: Standardization efforts
- **Modern era**: Gradual updates, romanization influences

## 8. Implementation Guidelines

### 8.1 Algorithm Design Implications

#### **Priority Order for Matching**
1. **Province identification** (highest confidence, smallest search space)
2. **District identification** within province constraints  
3. **Ward identification** within district constraints

#### **Fuzzy Matching Strategies**
```python
# Different tolerance levels by administrative level
fuzzy_tolerances = {
  'province': {
    'max_edits': 1,      # Provinces are well-known, strict matching
    'min_similarity': 0.9
  },
  'district': {
    'max_edits': 2,      # Medium tolerance for districts
    'min_similarity': 0.8  
  },
  'ward': {
    'max_edits': 3,      # Higher tolerance - most variability
    'min_similarity': 0.7
  }
}
```

### 8.2 Performance Optimization Guidelines

#### **Search Space Reduction**
- **Province-first strategy**: Identify province to constrain district search
- **Hierarchical pruning**: Use geographic constraints aggressively
- **Common case optimization**: Precompute frequent OCR patterns

#### **Caching Strategies**
- **Exact match cache**: Common address strings → results
- **Normalization cache**: Raw text → normalized text  
- **Pattern cache**: Compiled regex patterns

### 8.3 Error Handling Business Logic

#### **Partial Match Scenarios**
```python
# Business rules for partial matches
def handle_partial_match(province=None, district=None, ward=None):
    if province and district and not ward:
        confidence = 0.7  # Acceptable for many use cases
        status = "district_level_match"
        
    elif province and not district and not ward:
        confidence = 0.4  # Low confidence, limited utility
        status = "province_level_match"
        
    else:
        confidence = 0.1  # Very low confidence
        status = "insufficient_match"
```

#### **Confidence Thresholds for Business Decisions**
- **>0.9**: High confidence - use for critical applications
- **0.7-0.9**: Medium confidence - acceptable for most uses
- **0.4-0.7**: Low confidence - manual review recommended
- **<0.4**: Very low confidence - reject or flag for review

---

**Document Version**: 1.0  
**Last Updated**: [Current Date]  
**Status**: Complete - Ready for Algorithm Design

This domain knowledge document provides the foundation for building an accurate Vietnamese address classifier that respects the linguistic, geographic, and administrative complexities of the Vietnamese address system.